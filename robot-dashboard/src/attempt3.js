import React, { useRef, useEffect, useState } from 'react';
//import { connectWebSocket } from './coordinatesWS';

const coordinates_fixed = [
    {'x': 17.890765762240235, 'y': 6.8779724192699625, 'theta': -170.5926993061532},
    {'x': 17.890765762240235, 'y': 6.8779724192699625, 'theta': -170.5926993061532},
    {'x': 17.890768912121693, 'y': 6.877973147577329, 'theta': -170.5923035950098},
    {'x': 17.890770502239, 'y': 6.877973445063685, 'theta': -170.59210581966468},
    {'x': 17.890772063929248, 'y': 6.87797387608598, 'theta': -170.59190765715047},
    {'x': 17.890772063929248, 'y': 6.87797387608598, 'theta': -170.59190765715047},
    {'x': 17.890773655009582, 'y': 6.877974173675508, 'theta': -170.59170976849592},
    {'x': 17.890776809707347, 'y': 6.877974902488594, 'theta': -170.5913134906074},
    {'x': 17.890776809707347, 'y': 6.877974902488594, 'theta': -170.5913134906074},
    {'x': 17.890778373325524, 'y': 6.877975333707066, 'theta': -170.59111510127343},
    {'x': 17.89077996633298, 'y': 6.877975631502923, 'theta': -170.59091698599693},
    {'x': 17.890783124887207, 'y': 6.877976360718483, 'theta': -170.59052025466244},
    {'x': 17.890784690434753, 'y': 6.8779767921330865, 'theta': -170.59032163850404},
    {'x': 17.89078628537074, 'y': 6.877977090135253, 'theta': -170.59012329660226},
    {'x': 17.890787851883502, 'y': 6.877977521647904, 'theta': -170.58992456703032},
    {'x': 17.890787851883502, 'y': 6.877977521647904, 'theta': -170.58992456703032},
    {'x': 17.89079101526262, 'y': 6.877978251363904, 'theta': -170.5895272688289},
    {'x': 17.89079261212855, 'y': 6.877978549572353, 'theta': -170.5893287002999},
    {'x': 17.89079418057282, 'y': 6.877978981281067, 'theta': -170.58912974389892},
    {'x': 17.89079577840425, 'y': 6.877979279592647, 'theta': -170.5889310620559},
    {'x': 17.8907973478148, 'y': 6.877979711399373, 'theta': -170.58873199223973},
    {'x': 17.89079894661208, 'y': 6.877980009814081, 'theta': -170.58853319708263},
    {'x': 17.890800516989273, 'y': 6.877980441718808, 'theta': -170.588334013851},
    {'x': 17.890802116752752, 'y': 6.877980740236636, 'theta': -170.58813510537996},
    {'x': 17.890803688096945, 'y': 6.877981172239354, 'theta': -170.5879358087328},
    {'x': 17.890803688096945, 'y': 6.877981172239354, 'theta': -170.5879358087328},
    {'x': 17.890805288826982, 'y': 6.8779814708602975, 'theta': -170.587736786948},
    {'x': 17.89080846283545, 'y': 6.877982201685038, 'theta': -170.58733824178736},
    {'x': 17.89081003611469, 'y': 6.877982633883696, 'theta': -170.5871387183095},
    {'x': 17.890811638778885, 'y': 6.877982932710841, 'theta': -170.5869394698988},
    {'x': 17.890813213026178, 'y': 6.877983365007451, 'theta': -170.58673983300608},
    {'x': 17.890814816657972, 'y': 6.877983663937688, 'theta': -170.58654047128343},
    {'x': 17.890814816657972, 'y': 6.877983663937688, 'theta': -170.58654047128343},
    {'x': 17.890817996473423, 'y': 6.877984395365559, 'theta': -170.58614124594268},
    {'x': 17.89081957265789, 'y': 6.877984827858032, 'theta': -170.585941382222},
    {'x': 17.890821178225934, 'y': 6.8779851269944325, 'theta': -170.5857417938782},
    {'x': 17.890822755379514, 'y': 6.877985559584817, 'theta': -170.58554181674467},
    {'x': 17.890824361916202, 'y': 6.877985858824289, 'theta': -170.58534211509198},
    {'x': 17.890824361916202, 'y': 6.877985858824289, 'theta': -170.58534211509198},
    {'x': 17.89082594003925, 'y': 6.877986291512574, 'theta': -170.58514202454657},
    {'x': 17.890829126637804, 'y': 6.8779870236412775, 'theta': -170.58474200563015},
    {'x': 17.89083073511283, 'y': 6.877987323086867, 'theta': -170.58454207736378},
    {'x': 17.89083231517586, 'y': 6.87798775597091, 'theta': -170.5843417599981},
    {'x': 17.890833924620576, 'y': 6.8779880555195465, 'theta': -170.5841417184273},
    {'x': 17.890835505654124, 'y': 6.877988488501447, 'theta': -170.58394128765366},
    {'x': 17.890835505654124, 'y': 6.877988488501447, 'theta': -170.58394128765366},
    {'x': 17.89083711606888, 'y': 6.87798878815312, 'theta': -170.58374113278023},
    {'x': 17.890840309458426, 'y': 6.877989520987571, 'theta': -170.58334032042612},
    {'x': 17.890840309458426, 'y': 6.877989520987571, 'theta': -170.58334032042612},
    {'x': 17.89084350478992, 'y': 6.877990254022876, 'theta': -170.58293928136874},
    {'x': 17.890845088737116, 'y': 6.87799068729827, 'theta': -170.5827385103813},
    {'x': 17.890845088737116, 'y': 6.87799068729827, 'theta': -170.5827385103813},
    {'x': 17.890848286983157, 'y': 6.877991420632208, 'theta': -170.58233713122422},
    {'x': 17.890849901281506, 'y': 6.877991720695952, 'theta': -170.5821365231614},
    {'x': 17.890849901281506, 'y': 6.877991720695952, 'theta': -170.5821365231614},
    {'x': 17.890853102442986, 'y': 6.877992454333681, 'theta': -170.58173480402078},
    {'x': 17.890853102442986, 'y': 6.877992454333681, 'theta': -170.58173480402078},
    {'x': 17.89085468930697, 'y': 6.877992887902442, 'theta': -170.5815336928381},
    {'x': 17.890857893386112, 'y': 6.877993621838689, 'theta': -170.58113163361938},
    {'x': 17.890857893386112, 'y': 6.877993621838689, 'theta': -170.58113163361938},
    {'x': 17.890861099411005, 'y': 6.877994355975658, 'theta': -170.58072934772426},
    {'x': 17.890861099411005, 'y': 6.877994355975658, 'theta': -170.58072934772426},
    {'x': 17.890864307382344, 'y': 6.877995090313324, 'theta': -170.58032683515856},
    {'x': 17.890865926542915, 'y': 6.87799539089196, 'theta': -170.58012566066847},
    {'x': 17.890867517300805, 'y': 6.877995824851664, 'theta': -170.57992409592853},
    {'x': 17.890867517300805, 'y': 6.877995824851664, 'theta': -170.57992409592853},
    {'x': 17.890172678225454, 'y': 6.877880734220199, 'theta': -170.5701342637213},
    {'x': 17.888449233902094, 'y': 6.87759469386611, 'theta': -170.56201036860185},
    {'x': 17.888449233902094, 'y': 6.87759469386611, 'theta': -170.56201036860185},
    {'x': 17.88574369877794, 'y': 6.877145240189163, 'theta': -170.54962652576398},
    {'x': 17.87781687725076, 'y': 6.875826531487307, 'theta': -170.5247555198874},
    {'x': 17.87781687725076, 'y': 6.875826531487307, 'theta': -170.5247555198874},
    {'x': 17.86616364447366, 'y': 6.873882136520119, 'theta': -170.48661773902248},
    {'x': 17.86616364447366, 'y': 6.873882136520119, 'theta': -170.48661773902248},
    {'x': 17.850912425573718, 'y': 6.871319335942244, 'theta': -170.43988245077952},
    {'x': 17.850912425573718, 'y': 6.871319335942244, 'theta': -170.43988245077952},
    {'x': 17.84198979883842, 'y': 6.869817222123588, 'theta': -170.4151303743569},
    {'x': 17.83215432878663, 'y': 6.86815830861828, 'theta': -170.38649932053676},
    {'x': 17.810029442470245, 'y': 6.864411685771558, 'theta': -170.35944464458615},
    {'x': 17.797834185367027, 'y': 6.862340406227864, 'theta': -170.3536116864894},
    {'x': 17.78473662615231, 'y': 6.860110968602045, 'theta': -170.34496604145232},
    {'x': 17.770948157838287, 'y': 6.85776331003361, 'theta': -170.35330969047354},
    {'x': 17.756446563508334, 'y': 6.85529534446623, 'theta': -170.37641423618737},
    {'x': 17.756446563508334, 'y': 6.85529534446623, 'theta': -170.37641423618737},
    {'x': 17.72557320771569, 'y': 6.850050471117085, 'theta': -170.44183055044894},
    {'x': 17.70928432891131, 'y': 6.847291456229272, 'theta': -170.4689068614826},
    {'x': 17.70928432891131, 'y': 6.847291456229272, 'theta': -170.4689068614826},
    {'x': 17.674538921562927, 'y': 6.841432172507353, 'theta': -170.4917206324604},
    {'x': 17.65629500977311, 'y': 6.8383648357591005, 'theta': -170.4956927754338},
    {'x': 17.65629500977311, 'y': 6.8383648357591005, 'theta': -170.4956927754338},
    {'x': 17.61775881909378, 'y': 6.831899461379036, 'theta': -170.50183201041676},
    {'x': 17.597460648232957, 'y': 6.82849887601793, 'theta': -170.5069184812054},
    {'x': 17.576538632133378, 'y': 6.824996196829162, 'theta': -170.51500440964048},
    {'x': 17.554828154727073, 'y': 6.821364678223927, 'theta': -170.52371122283375},
    {'x': 17.554828154727073, 'y': 6.821364678223927, 'theta': -170.52371122283375},
    {'x': 17.509116289513916, 'y': 6.8137285934435905, 'theta': -170.54605328321168},
    {'x': 17.509116289513916, 'y': 6.8137285934435905, 'theta': -170.54605328321168},
    {'x': 17.460137076554663, 'y': 6.8055670698434225, 'theta': -170.57916542288433},
    {'x': 17.460137076554663, 'y': 6.8055670698434225, 'theta': -170.57916542288433},
    {'x': 17.40790469342793, 'y': 6.796889425265506, 'theta': -170.59552849613365},
    {'x': 17.375427826048316, 'y': 6.786559666407616, 'theta': -170.22727839936857},
    {'x': 17.34741783367914, 'y': 6.781718828742575, 'theta': -170.21186198737442},
    {'x': 17.34741783367914, 'y': 6.781718828742575, 'theta': -170.21186198737442},
    {'x': 17.318454922649984, 'y': 6.776713035361667, 'theta': -170.19818808415377},
    {'x': 17.25834145994369, 'y': 6.766300669372888, 'theta': -170.13938025557087},
    {'x': 17.25834145994369, 'y': 6.766300669372888, 'theta': -170.13938025557087},
    {'x': 17.195203337353057, 'y': 6.7553231217993925, 'theta': -170.08197872460386},
    {'x': 17.195203337353057, 'y': 6.7553231217993925, 'theta': -170.08197872460386},
    {'x': 17.17209207270593, 'y': 6.757215752950529, 'theta': -170.15841314370414},
    {'x': 17.14352941824629, 'y': 6.755258765692933, 'theta': -170.20632401268426},
    {'x': 17.109485955655252, 'y': 6.749385927409643, 'theta': -170.2202222417857},
  ];
  
var coordinat_idx = 0

const ImageUploader3 = () => {
  const canvasRef = useRef(null);
  const [coordinates, setCoordinates] = useState([]);

  useEffect(() => {
    const predefinedFilePath = process.env.PUBLIC_URL + '/map_peer_assignment-1.jpg';

    const img = new Image();
    img.onload = () => {
      const canvas = canvasRef.current;
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);

      // Plot coordinates on the canvas
      coordinates.forEach(coord => {
        plotCoordinate(ctx, coord);
      });
    };

    img.src = predefinedFilePath;
  }, [coordinates]);

  const plotCoordinate = (ctx, coord) => {
    const { x, y } = convertCoordinateToCanvas(coord);
    ctx.beginPath();
    ctx.arc(x, y, 5, 0, 2 * Math.PI, false);
    ctx.fillStyle = 'red';
    ctx.fill();
    ctx.lineWidth = 1;
    ctx.strokeStyle = 'black';
    ctx.stroke();
  };

  const convertCoordinateToCanvas = (coord) => {
    // Convert world coordinates to canvas coordinates based on image specs
    const resolution = 0.050000;
    const origin = [-4.142630, -12.520201, 0.000000];

    const canvasX = canvasRef.current.width - (coord.x - origin[0]) / resolution;
    const canvasY = canvasRef.current.height - (coord.y - origin[1]) / resolution;

    return { x: canvasX, y: canvasY };
  };

  const handleCoordinatesUpdate = () => {
    // Simulate updating coordinates at 1s interval
    setInterval(() => {
      // Sample coordinate
      const newCoordinate = coordinates_fixed[coordinat_idx]
      setCoordinates(prevCoordinates => [...prevCoordinates, newCoordinate]);
      coordinat_idx+= 1
      console.log(newCoordinate)
    }, 1000);
  };

  return (
    <div>
      <button onClick={handleCoordinatesUpdate}>Update Coordinates</button>
      {canvasRef && (
        <div>
          <canvas ref={canvasRef} />
        </div>
      )}
    </div>
  );
};

export default ImageUploader3;